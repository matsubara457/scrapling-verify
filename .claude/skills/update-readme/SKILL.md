---
name: update-readme
description: README.mdをプロジェクトの現状から自動生成・更新する（構造・セットアップ・コマンド・Skills一覧）
argument-hint: "[セクション指定(省略で全体更新)]"
disable-model-invocation: true
---

## 手順

### 1. 情報収集（並列実行）
以下を並列で読み込む:
- `CLAUDE.md` → プロジェクト概要・技術スタック・コマンド一覧
- `package.json`（ルート） → name, scripts, engines, packageManager
- `backend/package.json` + `frontend/package.json` → 主要依存パッケージ
- `.env.example` or `.env.local.example` → 環境変数一覧（存在しない場合は CLAUDE.md から最低限を推測）
- `docs/` 配下のファイル一覧 → ドキュメントリンク用
- `.claude/skills/*/SKILL.md` → frontmatter の name, description を収集（Skills総数カウント用）
- ルートディレクトリ構成（`ls` でツリー生成）

### 2. セクション生成
`$ARGUMENTS` でセクション指定可。省略時は全セクション生成。

有効な値: `overview`, `stack`, `structure`, `setup`, `commands`, `docs`, `skills`
→ 無効な値 → 全セクション生成（エラーにしない）

#### セクション構成
```
# プロジェクト名
> CLAUDE.mdの概要から1-2行

## 技術スタック
CLAUDE.mdから抽出。フロント/バック/DB/インフラの4カテゴリで箇条書き。

## ディレクトリ構成
ルート直下 + 主要サブディレクトリ（1階層）のツリー表示。
除外: node_modules, .git, dist, .next, .pnpm-store

## セットアップ
前提条件（Node.js, pnpm, PostgreSQL）→ clone → pnpm install → 環境変数設定 → DB初期化
環境変数は .env.example から列挙。なければ最低限（DATABASE_URL, JWT_SECRET等）を記載。

## コマンド一覧
package.json の scripts をテーブル形式で表示。
| コマンド | 説明 |

## ドキュメント
docs/ 配下のファイルへのリンク一覧（ファイル名→推定タイトル）。

## Claude Code Skills
`.claude/skills/*/SKILL.md` を直接カウントして総数 + 手動/自動の内訳を1行で表示。
主要スキル（/start, /done, /ship, /solve, /check）を簡易リスト。
詳細は `docs/skills.md` へリンク（/skills-doc で生成）。

## ライセンス
既存の LICENSE ファイルがあればリンク。なければセクション省略。
```

### 3. 差分チェック
既存 README.md がある場合:
- 現在の内容を読み込み
- `<!-- custom -->` ～ `<!-- /custom -->` で囲まれた手動セクションを保持
- 自動生成セクションのみ更新

### 4. 書き込み
README.md をルートに書き込み。先頭に生成タグ:
`<!-- auto-generated by /update-readme | last: YYYY-MM-DD -->`
初回生成時は末尾にカスタムセクションの案内を追加:
`<!-- custom -->` ～ `<!-- /custom -->` で囲むと自動更新時に保持される旨のHTMLコメント

### 5. 報告
```
===== README Updated =====
File:     README.md
Sections: N sections generated
Custom:   N custom sections preserved
Size:     N lines
===========================
```
