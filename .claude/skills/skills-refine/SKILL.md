---
name: skills-refine
description: 既存Skillを自己批判ループで改善する
argument-hint: "[スキル名(例: solve)] or --all"
disable-model-invocation: true
---

## 手順

### 1. 対象特定
- 引数がスキル名 → `.claude/skills/<name>/SKILL.md` を読む。存在しない → エラー終了
- `--all` → 全スキルを一覧。実務系を先に処理し、skills管理系(skills-*)は最後に処理
- 引数なし → エラー終了

### 2. 現状分析
対象SKILL.mdを読み、目的・手順・権限を把握。
`git log --oneline --all -- .claude/skills/<name>/` で変更履歴も確認。

### 3. 批判ループ（2回転）
以下の観点で批判→即修正。**2回繰り返す。** 問題なければ途中終了。

**批判観点:**
1. **安全性** — 破壊的操作の保護、allowed-tools最小権限
2. **エッジケース** — 引数なし/無効入力/中断時の後始末
3. **パス問題** — `cd`依存排除、`-C`フラグ/絶対パス使用、Bash毎回新シェル前提
4. **トークン効率** — 冗長排除、CLAUDE.md重複排除
5. **失敗モード** — 失敗箇所の特定、リカバリー手順、リトライ上限
6. **一貫性** — 他スキルとの構造・命名・報告形式の統一
7. **使用実態** — git log の変更履歴から過去の問題・改善パターンを反映しているか

**ルール:**
- 追加・修正のみ。スキルの目的や構造を大幅に変えない。
- 批判で「正しく動いている部分」を壊さない。
- 修正前後で意味が変わる場合は修正しない。

### 4. 報告
```
===== /<name> refined =====
改善点:  [箇条書き]
変更なし: [該当する場合]
===========================
```

### --all モード
全スキルを順に処理。**スキップ条件:** 直近5コミット以内に改善済みのスキルは飛ばす。
```
===== Skills Refine Summary =====
対象:     N skills
改善:     N skills (列挙)
スキップ: N skills
変更なし: N skills
=================================
```
