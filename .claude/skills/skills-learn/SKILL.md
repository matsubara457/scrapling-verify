---
name: skills-learn
description: Skill実行後にユーザーの修正・補足・エラー回避から学習し、Skillを自動改善する。会話中に自動発火。
disable-model-invocation: false
---

## 発火条件（必ず守る — 見逃し厳禁）

### 即時発火トリガー（1つでも該当したら即発火）
- ユーザーが Skill 出力を修正・やり直しさせた
- ユーザーが「次からはこうして」「多すぎる」「足りない」等フィードバック
- Skill 実行中にエラーを自力回避した（手順にないステップを追加）
- 参照パスが存在しなかった / CLAUDE.md と矛盾があった
- 外部レビューで同一 Skill の欠陥が指摘された

### ワークフロー統合チェックポイント（/solve, /done 完了時に必ず実行）
「自問」ではなく**構造的な差分検出を実行**する:
1. 今回使用したSkillのSKILL.mdの手順一覧をリストアップ
2. 実際のツール呼び出し履歴と比較
3. スキップされたPhase、追加された手順を特定
4. 乖離があれば即修正

## アクション（1分以内に完了）

### Step 1: 差分検出
- Skill定義の各Phaseを列挙
- 実際に実行した手順と1:1で突合
- 以下を特定:
  - **スキップされたPhase**: 不要だったか? → 不要なら条件付き実行に変更
  - **追加された手順**: 必要だったか? → 必要なら新Phaseとして追加
  - **順序変更**: より効率的だったか? → 効率的なら順序を変更

### Step 2: SKILL.md の自動修正
乖離が明確な場合は `.claude/skills/<name>/SKILL.md` を即修正（ユーザー承認不要）:
- 追加・修正のみ。構造破壊しない
- トークン効率維持（簡潔に）

### Step 3: Codex フィードバックループ
review-triage で ACCEPT した指摘がある場合:
- 指摘の根本原因がSkillの手順不足に起因するか判定
- 起因する場合 → auto-review の観点に追加、または該当Skillに予防手順を追加

### Step 4: Backlog 記録
乖離を auto-memory の `skill-patterns.md` の Skill Improvement Backlog に追記（ファイル未存在時は新規作成）:
- Skill名、乖離内容、優先度（HIGH/MED/LOW）、対応済みフラグ

### Step 5: 報告
```
📝 /<name> を改善: [1行で変更内容]
```

## 制約
- 大幅な構造変更はしない
- 同一セッションで同じ Skill を2回以上修正しない
- 実装タスクを中断しない（一段落してから実行）
